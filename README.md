# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
-------------------------------------------------------------------------------

## Общее описание реализации

При разработке проекта используется архитектурный паттерн MVP (Model-View-Presenter).
Слой Model содержит данные с которыми работает приложение. Занимается получением, преобразованием, передачей данных.
Слой View реализует отображение данных, поступающих из модели (сам не содержит никаких данных). Занимается отприсовкой данных,
согласно полученным шаблонам из html. 
Слой Presenter связывает два предыдущих слоя между собой, запуская методы объектов из слоев Model и View.
Код Presenter-а реализован непосредственно в файле index.ts, без написания отдельного класса для него.
В приложении реализован событийно - ориентированный подход с использованием брокера событий.


Слой модели реализуется с помощью классов: TODO
Слой представления реализуется с помощью классов: TODO
Так же в проекте используются следующие модули:
                    api.ts - класс для получения данных с сервера
                    events.ts - класс брокера событий, для реализации событийно -ориентированного подхода. 
                    components.ts - базовый класс для элементов представления.
---------------------------------------------------------------------------------

## Базовые компоненты

Базовый компонент - abstract class Component<T>

От него наследуются все классы представления. Имеет метод render(data?: Partial<T>): HTMLElement  
На вход получает объект, состоящий из некоторого кол-ва полей представленных в типе Т, и возвращающий HTMLElement "наполненный"
данными из этих полей.


----------------------------------

Базовый компонент - class Api - обеспечивает взаимодействие с сервером, предоставляя методы:
get(uri: string)  - запрашивает данные с сервера с запросом GET, параметром принимает endpoint.
post(uri: string, data: object, method: ApiPostMethods = 'POST') - метод, позволяющий делать POST, PUT, DELETE запросы.
В параметры  метода передаются: endpoint, тело запроса (body), метод запроса.

-----------------------------------

Базовый компонент - class EventEmitter реализует интерфейс IEvents.

 interface IEvents {
    on<T extends object>(event: EventName, callback: (data: T) => void): void;
    emit<T extends object>(event: string, data?: T): void;
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}
Класс содержит струтуру, представляющую собой коллекцию, ключом элемента коллекции является строка с именем события, значением - массив коллбеков, 
которые должны выполниться при возникновании события с названием из ключа.

метод on(name, callback) - установка обработчика: принимает имя события и callback функцию, которая выполнится при наступлении данного события.
метод emit(name, data?) - вызывает событие с именем, установленным в name, при наличии передает в callback данные  data.
--------------------------------------------------------------------------------

## Компоненты модели данных (Model)


Тип для описания способа оплаты товара
 type method =  'online' | 'uponReceipt';

Класс карточки: хранит данные карточки (товара)
  
card {
    id: string;              // id товара
    title:string;           //  заголовок товара
    description: string;     // описание товара 
    image:string;           // url товара
    category:string;        //   категория товара 
    price:number;           //  цена товара
    isAddedToBasket: boolean; // добавлен ли товар в корзину
    
}

-------------------------------------------------------------------------------

Класс списка карточек: содержит массив карточек типа card, и методы для работы с этим массивом

cardList{

 constructor(protected events: IEvents )  - принимает экземляр брокера событий для генерации событий изменения данных
 
 protected cardList:ICard[];// массив карточек
 protected bigCard:ICard;   // будет хранить карточку, которую кликнул пользователь   
 initList():void;           // метод заполняющий массив карточек. Метод получает данные с сервера, заполняет ими массив и передает
                            // экземпляру брокера событий events событие "cardList:updated"   
 addBigCard(card)           // метод для добавления каточки в качестве bigCard 
                            // Получает карточку, заполняет ею поле bigCard, передает брокеру событий "bigCard:changed" 
 removeBigCard(card)        // метод для удаления каточки в качестве bigCard
                            // чистит поле bigCard, передает брокеру событий "bigCard:changed" 

}
-------------------------------------------------------------------------------
Классы для хранения данных покупателя

Тип для описания способа оплаты товара
 type method =  'online' | 'uponReceipt';

orderingDelivery{
   protected      paymentMethod:method;  // переменная для хранения способа оплаты
   protected     deliveryAddress:string; //  переменная для хранения адреса доставки

   setOrderingDelivery(){} // устанавливает переменные
   validationorderingDelivery(){}  осуществляет валидацию данных

}

orderingContact {

  protected     email:string;   //  емайл покупателя    
  protected    telephone:string; // телефон покупателя

  setOrderingContact(){} // устанавливает переменные
  validationOrderingContact(){}  осуществляет валидацию данных
  
}

-------------------------------------------------------------------------------
    Корзина: хранит данные о товарах. 

 basket{

    constructor(protected events: IEvents )  - принимает экземляр брокера событий для генерации событий изменения данных
    protected cardListBasket:ICard[]; // массив карточек, добавленных в корзину
    protected totalPrise:number;  // общая сумма корзины
    remove(id:string):void; // метод удаляющий товар из корзины.
    add(id:string):void; // метод добавляющий товар в корзину.
    clear():void; // метод очищает корзину.
    getCardListBasket():ICard[] - возвращает cardListBasket 

    Методы add, remove, clear передают в брокер событий событие "basket::changed"  
    
}
-------------------------------------------------------------------------------

##  Компоненты представления

Класс отображения модального окна. Наследует класс Component

interface IModalContent {
    content: HTMLElement;
}


    Modal extends View<IModalData> { 
        protected _closeButton: HTMLButtonElement;  //переменная для хранения элемента кнопки
        protected _content: HTMLElement;        // переменная куда будет помещено внутренее содержимое модального окна
        constructor(container)  // получает элемент модального окна на странице, чтобы туда поместить содержимое

        set content(value: HTMLElement)  - сеттер для установки внутреннего содержиого _content
		        
        open();  // открытие модального окна
        close(); // закрытие модального окна
        render(data:IModalContent); // перерисовка внутреннего содержимого (content) через set content(), и возвращает весь container

    }





## Компоненты представления


Карточка отображается в трех видах:
                                    1. основной вид
                                    2. в попапе
                                    3. в корзине

В данный класс в конструктор передается template (три варианта)

cardView{      // класс для всех отображений карточки

   _id:string
   protected  cardElement: HTMLElement;
   protected  description: HTMLElement;     
   protected  image:       HTMLElement;          
   protected  title:       HTMLElement;         
   protected  category:    HTMLElement;    
   protected  price:       HTMLElement;         
   ...


   render(card: ICard):HTMLElement {}  //    будет наполнять наш темплэйт данными из модели
         
}

cardViewInList{ // отображает список карточек
в конструктор передается контейнер, в который будет передан HTMLElement содержащий последовательный набор карточек


protected cardList: cardView[];
    render():HTMLElement -  возвращает набор cardView элементов и вставляет их в контейнер
}



-------------------------------------------------

Попапы:

Базовый класс - в него будем вставлять разное содержимое - сам по себе (пустой попап - не выводится)


popup{                    //     получает базовый  template (форму и крестик)
    content:HTMLElement;  // сюда попап получает содержимое и кладет его в попап (например  new cardView() )
}

Попап корзины
popupBusket{         // наследует popup
                     // получает template содержимого корзины  и заполняет его через  busketCardView
}

Попап способа оплаты
popupPaymentMethod {        // наследует popup

                             // получает buyer и свой template
                                заполняет и отдает заполненный template
}

Попап email
popupEmail {        // наследует popup
                            // получает buyer и свой template
                                заполняет и отдает заполненный template
}


Попап подтверждения покупки

popupSuccessful{  // наследует popup
                // получает свой template,  получает корзину, выводит общую сумму, рендерит

}

------------------------------------------------------------------------------
## Слой presenter 
выделять в отдельный класс не планируется, состыковка модели и предтавления будет
происходить в основном файле index.ts


-------------------------------------------------------------------------------
## Описание событий 
События будут обрабатываться через брокер событий.


События генерируемые из view:
1. Нажатие на одну из карточек (view генерирует событие) и передает его в презентер -> Обработчик события в презентере запускает метод addBigCard(card),
который кладет карточку в модель. Модель генерирует событие, что изменилось содержание  bigCard. Презентер запускает метод renderview  (возможно просто открывает попап с карточкой, потому что список карточек у нас не меняется)
Событие card:select. 

2. Событие закрытия попапа через esc 
3. Событие закрытия попапа через клик вне попапа
4. Событие закрытия попапа через крестик
5. Событие нажатия купить в попапе карточки
6. Событие нажатия на корзину
7. Событие нажатия на кнопку оформить
8. Событие нажатия на кнопку оплатить
9. Событие нажатия на кнопку за новыми покупками

-------------------------------------------------------------------------------
